<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor List</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Custom styling on top of Bootstrap */
        body {
            padding-top: 0;
            background-color: #f8f9fa;
            font-size: 0.875rem; /* Base font size reduction */
        }
        
        .navbar {
            margin-bottom: 20px;
        }
        
        .table-responsive {
            border-radius: 0.375rem;
            overflow: hidden;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        
        .table {
            margin-bottom: 0;
            table-layout: fixed;
            font-size: 0.8rem; /* Reduced table font size */
        }
        
        .table th {
            background-color: #f8f9fa;
            position: sticky;
            top: 0;
            z-index: 10;
            font-weight: 600;
            font-size: 0.75rem; /* Smaller header font */
        }
        
        .table td, .table th {
            padding: 0.25rem 0.4rem;
            vertical-align: middle;
        }
        
        /* Column widths */
        .table th:nth-child(1), .table td:nth-child(1) { /* ID */
            width: 40px;
        }
        
        .table th:nth-child(2), .table td:nth-child(2) { /* Vendor */
            width: 160px;
        }
        
        .table th:nth-child(3), .table td:nth-child(3) { /* Status */
            width: 100px;
        }
        
        .table th:nth-child(4), .table td:nth-child(4) { /* Vendor Type */
            width: 220px;
        }
        
        .table th:nth-child(5), .table td:nth-child(5) { /* MBL Audited */
            width: 100px;
        }
        
        /* Vendor name truncation */
        .table td:nth-child(2) {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Status tag styling */
        .status-tag {
            display: inline-flex;
            align-items: center;
            border-radius: 0.25rem;
            padding: 0.125rem 0.375rem;
            font-size: 0.7rem;
            font-weight: 600;
            width: fit-content;
        }
        
        .status-partner {
            background-color: #d1e7dd;
            border: 1px solid #badbcc;
        }
        
        .status-shortlist {
            background-color: #fff3cd;
            border: 1px solid #ffecb5;
        }
        
        .status-none {
            background-color: #f8f9fa;
            border: 1px solid #ced4da;
        }
        
        /* MBL Audited styling */
        .mbl-tag {
            display: inline-flex;
            align-items: center;
            border-radius: 0.25rem;
            padding: 0.125rem 0.375rem;
            font-size: 0.7rem;
            font-weight: 600;
            width: fit-content;
        }
        
        .mbl-yes {
            background-color: #d1e7dd;
            border: 1px solid #badbcc;
        }
        
        .mbl-no {
            background-color: #f8f9fa;
            border: 1px solid #ced4da;
        }
        
        /* Vendor Type styling */
        .vendor-type-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        
        .vendor-type-tag {
            display: inline-flex;
            align-items: center;
            background-color: #f8f9fa;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            padding: 0.125rem 0.375rem;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        /* Purpose/Feature styling */
        .purpose-cell {
            text-align: center;
        }
        
        .purpose-yes {
            color: #198754;
        }
        
        .purpose-no {
            color: #adb5bd;
        }
        
        /* Filter controls */
        .filter-controls {
            background-color: #fff;
            border-radius: 0.375rem;
            padding: 0.75rem;
            margin-bottom: 1rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .filter-label {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0;
            white-space: nowrap;
        }
        
        .filter-control {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            border: 1px solid #ced4da;
        }
        
        .results-count {
            font-size: 0.8rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">TCF Vendor Explorer</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/vendorlist">Vendor List</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/purposeslist">Purposes List</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/vendor-management">Vendor Management</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="container-fluid">
        <!-- Filter Controls -->
        <div class="filter-controls">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="searchInput" class="filter-label">Search:</label>
                    <input type="text" id="searchInput" class="filter-control" placeholder="Vendor name..." onkeyup="filterTable()">
                </div>
                <div class="filter-group">
                    <label for="statusFilter" class="filter-label">Status:</label>
                    <select id="statusFilter" class="filter-control" onchange="filterTable()">
                        <option value="all">All</option>
                        <option value="Partner">Partner</option>
                        <option value="Shortlist">Shortlist</option>
                        <option value="none">None</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="typeFilter" class="filter-label">Vendor Type:</label>
                    <select id="typeFilter" class="filter-control" onchange="filterTable()">
                        <option value="all">All</option>
                        <option value="ssp">SSP</option>
                        <option value="dsp">DSP</option>
                        <option value="ads">Ads</option>
                        <option value="networks">Networks</option>
                        <option value="measurement">Measurement</option>
                        <option value="other">Other</option>
                        <option value="none">None</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="mblFilter" class="filter-label">MBL Audited:</label>
                    <select id="mblFilter" class="filter-control" onchange="filterTable()">
                        <option value="all">All</option>
                        <option value="Yes">Yes</option>
                        <option value="No/Unknown">No/Unknown</option>
                    </select>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="purposeFilter" class="filter-label">Purpose:</label>
                    <select id="purposeFilter" class="filter-control" onchange="filterTable()">
                        <option value="all">All</option>
                        <option value="p1">P1: Store and/or access information on a device</option>
                        <option value="p2">P2: Select basic ads</option>
                        <option value="p3">P3: Create a personalised ads profile</option>
                        <option value="p4">P4: Select personalised ads</option>
                        <option value="p5">P5: Create a personalised content profile</option>
                        <option value="p6">P6: Select personalised content</option>
                        <option value="p7">P7: Measure ad performance</option>
                        <option value="p8">P8: Measure content performance</option>
                        <option value="p9">P9: Apply market research</option>
                        <option value="p10">P10: Develop and improve products</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="specialPurposeFilter" class="filter-label">Special Purpose:</label>
                    <select id="specialPurposeFilter" class="filter-control" onchange="filterTable()">
                        <option value="all">All</option>
                        <option value="sp1">SP1: Ensure security, prevent fraud, and debug</option>
                        <option value="sp2">SP2: Technically deliver ads or content</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="featureFilter" class="filter-label">Feature:</label>
                    <select id="featureFilter" class="filter-control" onchange="filterTable()">
                        <option value="all">All</option>
                        <option value="f1">F1: Match and combine offline data sources</option>
                        <option value="f2">F2: Link different devices</option>
                        <option value="f3">F3: Receive and use automatically-sent device characteristics</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="specialFeatureFilter" class="filter-label">Special Feature:</label>
                    <select id="specialFeatureFilter" class="filter-control" onchange="filterTable()">
                        <option value="all">All</option>
                        <option value="sf1">SF1: Use precise geolocation data</option>
                        <option value="sf2">SF2: Actively scan device characteristics</option>
                    </select>
                </div>
            </div>
            <div class="filter-row">
                <span id="resultsCount" class="results-count">Showing all vendors</span>
            </div>
        </div>
        
        <!-- Vendor Table -->
        <div class="table-responsive">
            <table id="vendorTable" class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Vendor</th>
                        <th>Status</th>
                        <th>Vendor Type</th>
                        <th>MBL Audited</th>
                        <th>P1</th>
                        <th>P2</th>
                        <th>P3</th>
                        <th>P4</th>
                        <th>P5</th>
                        <th>P6</th>
                        <th>P7</th>
                        <th>P8</th>
                        <th>P9</th>
                        <th>P10</th>
                        <th>SP1</th>
                        <th>SP2</th>
                        <th>F1</th>
                        <th>F2</th>
                        <th>F3</th>
                        <th>SF1</th>
                        <th>SF2</th>
                    </tr>
                </thead>
                <tbody>
                    {% for vendor in vendors %}
                    <tr>
                        <td>{{ vendor.id }}</td>
                        <td title="{{ vendor.name }}">{{ vendor.name }}</td>
                        <td>
                            {% if vendor.status %}
                                <span class="status-tag {% if vendor.status == 'Partner' %}status-partner{% elif vendor.status == 'Shortlist' %}status-shortlist{% else %}status-none{% endif %}">
                                    {{ vendor.status }}
                                </span>
                            {% else %}
                                <span class="status-tag status-none">None</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="vendor-type-container">
                                {% if vendor.vendorTypes %}
                                    {% for type in vendor.vendorTypes %}
                                        <span class="vendor-type-tag" data-type="{{ type }}">
                                            {% if type == 'ssp' %}SSP
                                            {% elif type == 'dsp' %}DSP
                                            {% elif type == 'ads' %}Ads
                                            {% elif type == 'networks' %}Net
                                            {% elif type == 'measurement' %}Meas
                                            {% elif type == 'other' %}Other
                                            {% else %}{{ type }}
                                            {% endif %}
                                        </span>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </td>
                        <td>
                            {% if vendor.mblAudited == 'Yes' %}
                                <span class="mbl-tag mbl-yes">Yes</span>
                            {% else %}
                                <span class="mbl-tag mbl-no">No/Unknown</span>
                            {% endif %}
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.p1 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.p2 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.p3 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.p4 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.p5 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.p6 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.p7 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.p8 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.p9 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.p10 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.sp1 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.sp2 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.f1 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.f2 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.f3 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.sf1 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                        <td class="purpose-cell">
                            <i class="bi {% if vendor.sf2 %}bi-check-circle-fill purpose-yes{% else %}bi-x-circle purpose-no{% endif %}"></i>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Function to filter the table
        function filterTable() {
            var searchInput = document.getElementById("searchInput");
            var searchFilter = searchInput.value.toUpperCase();
            var statusFilter = document.getElementById("statusFilter").value;
            var typeFilter = document.getElementById("typeFilter").value;
            var mblFilter = document.getElementById("mblFilter").value;
            var purposeFilter = document.getElementById("purposeFilter").value;
            var specialPurposeFilter = document.getElementById("specialPurposeFilter").value;
            var featureFilter = document.getElementById("featureFilter").value;
            var specialFeatureFilter = document.getElementById("specialFeatureFilter").value;
            
            var table = document.getElementById("vendorTable");
            var tr = table.getElementsByTagName("tr");
            var visibleCount = 0;
            
            // Loop through all table rows, and hide those who don't match the search query
            for (var i = 1; i < tr.length; i++) { // Start from 1 to skip header row
                var nameCell = tr[i].getElementsByTagName("td")[1];
                var statusCell = tr[i].getElementsByTagName("td")[2];
                var typeCell = tr[i].getElementsByTagName("td")[3];
                var mblCell = tr[i].getElementsByTagName("td")[4];
                
                if (nameCell && statusCell && typeCell && mblCell) {
                    var nameValue = nameCell.textContent || nameCell.innerText;
                    var statusTag = statusCell.querySelector(".status-tag");
                    var statusValue = statusTag ? statusTag.textContent.trim() : "";
                    var typeTags = typeCell.getElementsByClassName("vendor-type-tag");
                    var typeValues = [];
                    
                    for (var j = 0; j < typeTags.length; j++) {
                        typeValues.push(typeTags[j].getAttribute("data-type"));
                    }
                    
                    var mblTag = mblCell.querySelector(".mbl-tag");
                    var mblValue = mblTag ? mblTag.textContent.trim() : "";
                    
                    // Check purpose/feature filters
                    var matchesPurpose = true;
                    if (purposeFilter !== 'all') {
                        var purposeIndex = parseInt(purposeFilter.substring(1)) + 4; // p1 is at index 5
                        var purposeCell = tr[i].getElementsByTagName("td")[purposeIndex];
                        var purposeIcon = purposeCell.querySelector("i");
                        matchesPurpose = purposeIcon.classList.contains("purpose-yes");
                    }
                    
                    var matchesSpecialPurpose = true;
                    if (specialPurposeFilter !== 'all') {
                        var spIndex = parseInt(specialPurposeFilter.substring(2)) + 14; // sp1 is at index 15
                        var spCell = tr[i].getElementsByTagName("td")[spIndex];
                        var spIcon = spCell.querySelector("i");
                        matchesSpecialPurpose = spIcon.classList.contains("purpose-yes");
                    }
                    
                    var matchesFeature = true;
                    if (featureFilter !== 'all') {
                        var fIndex = parseInt(featureFilter.substring(1)) + 16; // f1 is at index 17
                        var fCell = tr[i].getElementsByTagName("td")[fIndex];
                        var fIcon = fCell.querySelector("i");
                        matchesFeature = fIcon.classList.contains("purpose-yes");
                    }
                    
                    var matchesSpecialFeature = true;
                    if (specialFeatureFilter !== 'all') {
                        var sfIndex = parseInt(specialFeatureFilter.substring(2)) + 19; // sf1 is at index 20
                        var sfCell = tr[i].getElementsByTagName("td")[sfIndex];
                        var sfIcon = sfCell.querySelector("i");
                        matchesSpecialFeature = sfIcon.classList.contains("purpose-yes");
                    }
                    
                    var matchesSearch = nameValue.toUpperCase().indexOf(searchFilter) > -1;
                    var matchesStatus = statusFilter === 'all' || 
                                       (statusFilter === 'none' && statusValue === 'None') || 
                                       statusValue === statusFilter;
                    var matchesType = typeFilter === 'all' || 
                                     (typeFilter === 'none' && typeValues.length === 0) || 
                                     typeValues.includes(typeFilter);
                    var matchesMBL = mblFilter === 'all' || mblValue === mblFilter;
                    
                    if (matchesSearch && matchesStatus && matchesType && matchesMBL && 
                        matchesPurpose && matchesSpecialPurpose && matchesFeature && matchesSpecialFeature) {
                        tr[i].style.display = "";
                        visibleCount++;
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
            
            // Update the results count
            document.getElementById("resultsCount").textContent = "Showing " + visibleCount + " of " + (tr.length - 1) + " vendors";
        }
        
        // Initialize the table filter
        document.addEventListener('DOMContentLoaded', function() {
            filterTable();
        });
    </script>
</body>
</html> 